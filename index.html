<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <title>Raken 運勢鞭炮 Overlay</title>
    <script src="https://cdn.jsdelivr.net/npm/comfy.js@1.1.6/dist/comfy.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; font-family: "Microsoft JhengHei", sans-serif; background: transparent; }
        #overlay-container { width: 100vw; height: 100vh; position: relative; display: flex; justify-content: center; align-items: center; flex-direction: column; }
        .announcement { text-align: center; font-size: 60px; font-weight: bold; color: #ff2424; text-shadow: 0 0 15px gold, 2px 2px 0px #8b0000; opacity: 0; transform: scale(0.5); transition: all 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275); z-index: 10; }
        .particle { position: absolute; width: 12px; height: 18px; pointer-events: none; z-index: 5; }
        @keyframes shake { 0% { transform: translate(8px, 8px); } 25% { transform: translate(-8px, -8px); } 50% { transform: translate(-8px, 8px); } 75% { transform: translate(8px, -8px); } 100% { transform: translate(0, 0); } }
        .shaking { animation: shake 0.1s infinite; }
    </style>
</head>
<body onclick="testEffect()">
    <div id="overlay-container">
        <div id="text-display" class="announcement"></div>
    </div>
<script>
    const params = new URLSearchParams(window.location.search);
    const channel = params.get('channel') || 'rakenluck111';
    const targetReward = params.get('reward') || "放鞭炮";
    const quotes = ["新的一年，垃圾桶裡都是寶藏！", "新的一年，剪輯速度突破天際！", "新的一年，所有霉運都被炸飛啦！", "新的一年，浣熊尾巴又順又亮！", "新的一年，紅紅火火大吉大利！"];
    let effectQueue = []; let isPlaying = false;
    ComfyJS.onRewardRedemption = (user, reward) => { if (reward === targetReward) { effectQueue.push({ user: user }); processQueue(); } };
    function processQueue() { if (!isPlaying && effectQueue.length > 0) { const next = effectQueue.shift(); runAnimation(next.user); } }
    function runAnimation(user) {
        isPlaying = true; const textDisplay = document.getElementById('text-display');
        textDisplay.innerHTML = `<div style="font-size: 40px;">${user} 驅散了霉運</div><div>${quotes[Math.floor(Math.random() * quotes.length)]}</div>`;
        textDisplay.style.opacity = 1; textDisplay.style.transform = "scale(1)";
        document.body.classList.add('shaking');
        for(let i=0; i<60; i++) { createParticle(); }
        setTimeout(() => { textDisplay.style.opacity = 0; textDisplay.style.transform = "scale(0.5)"; document.body.classList.remove('shaking'); setTimeout(() => { isPlaying = false; processQueue(); }, 500); }, 4000);
    }
    function createParticle() {
        const p = document.createElement('div'); p.className = 'particle'; document.getElementById('overlay-container').appendChild(p);
        const x = window.innerWidth / 2, y = window.innerHeight / 2;
        const destX = (Math.random() - 0.5) * 1000, destY = (Math.random() - 0.5) * 1000;
        p.style.left = x + 'px'; p.style.top = y + 'px'; p.style.backgroundColor = Math.random() > 0.3 ? '#ff2424' : '#ffd700';
        p.animate([{ transform: 'translate(0, 0) rotate(0deg)', opacity: 1 }, { transform: `translate(${destX}px, ${destY}px) rotate(${Math.random()*720}deg)`, opacity: 0 }], { duration: 1500 + Math.random() * 1000, easing: 'ease-out' }).onfinish = () => p.remove();
    }
    function testEffect() { effectQueue.push({ user: "測試小夥伴" }); processQueue(); }
    if(channel) { ComfyJS.Init(channel); }
</script>
</body>
</html>
